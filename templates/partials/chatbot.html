{% extends "base.html" %}

{% block title %}Chatbot | Casa en el Árbol{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Chat Container -->
            <div class="chat-container-main" id="chatContainer">
                <!-- Header del chat -->
                <div class="chat-header">
                    <div class="chat-status">
                        <div class="chat-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div class="chat-info">
                            <h4>Asistente Casa en el Árbol</h4>
                            <p>
                                <span class="status-indicator" id="connectionStatus"></span>
                                <span id="statusText">Conectando...</span>
                            </p>
                        </div>
                        <div class="chat-controls">
                            <button class="btn btn-sm btn-outline-light" onclick="clearChat()" title="Limpiar chat">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-light" onclick="exportChat()" title="Exportar conversación">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cuerpo del chat -->
                <div class="chat-body" id="chat-messages">
                    <!-- mensajes dinámicos -->
                    
                    <!-- Indicador de escritura -->
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="message-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="typing-dots">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Respuestas rápidas -->
                <div class="quick-replies" id="quickReplies"></div>

                <!-- Input del chat -->
                <div class="chat-input-container">
                    <div class="chat-input-group">
                        <textarea 
                            class="chat-input" 
                            id="user-input" 
                            placeholder="Escribe tu mensaje aquí..." 
                            rows="1"
                            maxlength="500"
                        ></textarea>
                        <button class="chat-send-btn" id="chatSendBtn" onclick="sendMessage()" disabled>
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                    <div class="chat-input-info">
                        <small class="text-muted">
                            <span id="charCount">0</span>/500 caracteres
                            | Presiona Enter para enviar, Shift+Enter para nueva línea
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.js"></script>
<script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
{% endblock %}
