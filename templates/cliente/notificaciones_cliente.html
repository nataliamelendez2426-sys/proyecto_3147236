<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Notificaciones</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos propios -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/formularios.css') }}">  
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nosotros.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}">
  <style>
    body {
      background: linear-gradient(135deg, #f0f2f5, #d9e4dd);
      font-family: 'Segoe UI', sans-serif;
    }

    .noti-card {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      max-width: 720px;
      margin: 50px auto;
      padding: 30px;
      display: flex;
      flex-direction: column;
    }

    .noti-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .noti-header h5 {
      font-weight: 700;
      color: #4e7b33;
      letter-spacing: 0.5px;
      font-size: 1.4rem;
    }

    .btn-select-all, .btn-delete {
      background-color: #5f8f3f;
      color: #fff;
      font-weight: 600;
      border-radius: 10px;
      border: none;
      padding: 8px 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .btn-select-all:hover, .btn-delete:hover {
      background-color: #3a6127;
    }

    .noti-list {
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-right: 5px; /* espacio para scrollbar */
    }

    .noti-item {
      display: flex;
      align-items: center;
      gap: 15px;
      background: #f8f9fa;
      border-radius: 15px;
      padding: 15px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .noti-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .noti-item p {
      margin: 0;
      flex-grow: 1;
      font-size: 0.95rem;
      color: #333;
    }

    .noti-item .fecha {
      font-size: 0.8rem;
      color: #777;
      margin-left: 10px;
    }

    .empty-msg {
      text-align: center;
      font-style: italic;
      color: #999;
      margin: 50px 0;
      font-size: 1.1rem;
    }

    /* Scrollbar bonito */
    .noti-list::-webkit-scrollbar {
      width: 6px;
    }
    .noti-list::-webkit-scrollbar-thumb {
      background-color: #5f8f3f;
      border-radius: 10px;
    }
    .noti-list::-webkit-scrollbar-track {
      background: transparent;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top bg-light shadow-sm">
  <div class="container-fluid px-4">
    <!-- Marca -->
    <a class="navbar-brand fw-bold" href="{{ url_for('index') }}">
      Casa en el Árbol
    </a>

    <!-- Botón hamburguesa -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain"
      aria-controls="navbarMain" aria-expanded="false" aria-label="Menú">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Contenido colapsable -->
    <div class="collapse navbar-collapse" id="navbarMain">
      <!-- Buscador -->
      <div class="search-container mx-auto d-none d-md-block">
        <input class="form-control" type="search" placeholder="¿Qué estás buscando hoy?" aria-label="Buscar" id="searchInput">
      </div>

      <!-- Iconos alineados a la derecha -->
      <div class="d-flex align-items-center gap-3 ms-auto">
        <!-- Favoritos -->
        <a href="{{ url_for('cliente.ver_favoritos') }}" class="nav-icon" aria-label="Favoritos">
          <i class="bi bi-heart fs-4"></i>
        </a>

        <!-- Dropdown usuario -->
        <div class="dropdown">
          <a class="nav-icon dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-label="Cuenta de usuario">
            <i class="bi bi-person fs-4"></i>
          </a>
          {% if session.get('user_id') %}
          <!-- Usuario logueado -->
         <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{{ url_for('auth.login') }}"><i class="bi bi-box-arrow-in-right me-2"></i>Iniciar sesión</a></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.register') }}"><i class="bi bi-person-plus me-2"></i>Registrarse</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-key me-2"></i>Recuperar contraseña</a></li>
          </ul>
          {% else %}
          <!-- Usuario no logueado -->
         
            <ul class="dropdown-menu dropdown-menu-end p-3" style="width: 250px;">
          <div class="d-flex align-items-center mb-3">
        <div class="rounded-circle bg-light border text-dark fw-bold d-flex align-items-center justify-content-center me-2"
            style="width: 45px; height: 45px; font-size: 16px;">
            {{ session.get('iniciales', '??') }}
        </div>
        <strong class="text-uppercase">
            {{ session.get('username', 'Invitado') }}
        </strong>
        </div>

            <li><a class="dropdown-item" href="{{ url_for('cliente.actualizacion_datos') }}">Perfil</a></li>
            <li><a class="dropdown-item" href="">Historial</a></li>
            <li><a class="dropdown-item" href="#">Mis pedidos</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cliente.resenas') }}">Reseñas</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cliente.ver_notificaciones_cliente') }}">Notificaciones</a></li>
            <div class="mt-3">
              <a href="{{ url_for('auth.logout') }}" class="btn btn-primary w-100">Cerrar sesión</a>
            </div>
          </ul>
          {% endif %}
        </div>

        <!-- Carrito -->
        <a href="#" class="nav-icon position-relative" onclick="toggleCart()" aria-label="Carrito de compras">
          <i class="bi bi-cart fs-4"></i>
          <span class="cart-badge" id="cart-count">0</span>
        </a>
      </div>
    </div>
  </div>
</nav>
<!-- Bloque de mensajes flash SOLO para notificaciones -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      {% if category.startswith('notificaciones') %}
        <div 
          class="alert 
                 {% if 'success' in category %}alert-success
                 {% elif 'warning' in category %}alert-warning
                 {% elif 'danger' in category %}alert-danger
                 {% else %}alert-info{% endif %} 
                 alert-dismissible fade show mt-3"
          role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Bloque de mensajes flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

    {% if session.get('show_welcome_modal') %}
<!-- Modal de bienvenida -->
<div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header border-0">
        <h5 class="modal-title w-100" id="welcomeModalLabel">
          ¡Bienvenid@{{ ', ' + session['username'] if session['username'] else '' }}!
        </h5>
      </div>
      <div class="modal-body">
        <p class="mb-4">Gracias por iniciar sesión en <strong>Casa en el Árbol</strong>.</p>
        <a href="{{ url_for('dashboard') }}" class="btn custom-btn px-4 py-2">Ir a la página principal</a>
      </div>
    </div>
  </div>
</div>

<!-- Script para mostrar el modal al cargar la página -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
    welcomeModal.show();
  });
</script>

<!-- Eliminar la variable de sesión para que no vuelva a mostrarse -->
{% set _ = session.pop('show_welcome_modal') %}
{% endif %}


    <!-- Menú principal separado del navbar para evitar confusiones -->
    <div class="section-menu py-3 bg-white shadow-sm" style="margin-top: 80px;">
        <div class="container">
            <ul class="nav justify-content-center flex-wrap">
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#" onclick="filterProducts('all')">
                        <i class="bi bi-grid me-1"></i>CATEGORÍAS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="{{ url_for('nosotros') }}">
                        <i class="bi bi-info-circle me-1"></i>NOSOTROS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#" onclick="scrollToCatalog()">
                        <i class="bi bi-collection me-1"></i>CATÁLOGO
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#" onclick="filterProducts('ofertas')">
                        <i class="bi bi-tag me-1"></i>OFERTAS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#">
                        <i class="bi bi-shield-check me-1"></i>GARANTÍAS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#">
                        <i class="bi bi-tools me-1"></i>INSTALACIONES
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#">
                        <i class="bi bi-chat-dots me-1"></i>CHATBOT
                    </a>
                </li>
            </ul>
        </div>
    </div>
  <div class="container">
    <div class="noti-card">
      <div class="noti-header">
        <h5><i class="bi bi-bell-fill me-2"></i>NOTIFICACIONES</h5>
        <button type="button" class="btn-select-all" onclick="seleccionarTodos()">
          <i class="bi bi-check2-square me-1"></i> Seleccionar todos
        </button>
      </div>

      <form method="POST" action="{{ url_for('cliente.ver_notificaciones_cliente') }}">
        {% if notificaciones %}
          <div class="noti-list">
            {% for noti in notificaciones %}
            <div class="noti-item">
              <input type="checkbox" name="ids" value="{{ noti.ID_Notificacion }}">
              <p>{{ noti.Mensaje }}</p>
              <span class="fecha">{{ noti.Fecha.strftime('%d/%m/%Y %H:%M') }}</span>
            </div>
            {% endfor %}
          </div>
          <div class="text-end mt-3">
            <button type="submit" class="btn-delete"><i class="bi bi-trash-fill me-1"></i>Eliminar seleccionadas</button>
          </div>
        {% else %}
          <p class="empty-msg">¡No tienes notificaciones por ahora!</p>
        {% endif %}
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function seleccionarTodos() {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
    }
  </script>
</body>
</html>
