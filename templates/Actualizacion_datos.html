<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Usuario</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --primary-green: #5f8f3f;
      --secondary-green: #4e7b33;
      --light-green: #6c9a50;
      --accent-green: #7cb342;
      --accent-green-light: #a8d374;
      --bg-cream: #f8f6f0;
      --text-dark: #2c3e50;
      --shadow-light: rgba(0, 0, 0, 0.08);
      --shadow-medium: rgba(0, 0, 0, 0.15);
    }
    body { background-color: var(--bg-cream); font-family: 'Segoe UI', sans-serif; color: var(--text-dark); }
    .sidebar { background: #fff; border-radius: 15px; padding: 1.5rem 1rem; min-height: 100vh; box-shadow: 0 4px 8px var(--shadow-light); }
    .sidebar h4 { color: var(--primary-green); font-weight: 700; margin-bottom: 2rem; text-align: center; }
    .sidebar a { display: block; padding: 12px 15px; margin-bottom: 8px; color: var(--text-dark); border-radius: 12px; text-decoration: none; transition: all 0.25s ease; font-weight: 500; cursor: pointer; }
    .sidebar a:hover { background-color: var(--accent-green-light); color: #fff; }
    .sidebar a.active { background-color: var(--accent-green); color: #fff; font-weight: 600; box-shadow: 0 2px 6px var(--shadow-medium); }
    .card { border-radius: 15px; border: none; box-shadow: 0 4px 10px var(--shadow-light); margin-bottom: 1.5rem; }
    .form-control { border-radius: 50px; border: 1px solid var(--light-green); transition: all 0.2s ease; height: 50px; }
    .form-control:focus { border-color: var(--accent-green); box-shadow: 0 0 6px var(--accent-green-light); }
    .profile-header { display: flex; justify-content: space-between; align-items: center; }
    .profile-header h5 { color: var(--primary-green); font-weight: 700; }
    .btn-green { background: var(--accent-green); color: #fff; border-radius: 50px; padding: 8px 20px; font-weight: 600; border: none; transition: all 0.3s ease; }
    .btn-green:hover { background: var(--secondary-green); color: #fff; }
  </style>
</head>
<body>
<div class="container-fluid mt-4">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 mb-4">
      <div class="sidebar shadow-sm">
        <h4>üåø HOLA!</h4>
        <a id="menu-perfil" class="active"><i class="bi bi-person-circle me-2"></i>Perfil</a>
        <a id="menu-direcciones"><i class="bi bi-geo-alt me-2"></i>Direcciones</a>
        <a><i class="bi bi-box-seam me-2"></i>Pedidos</a>
        <a><i class="bi bi-heart me-2"></i>Favoritos</a>
        <a href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right me-2"></i>Salir</a>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="col-md-9 col-lg-10">
      <!-- Secci√≥n Perfil -->
      <div id="seccion-perfil" class="card shadow-sm p-4">
        <div class="profile-header mb-4">
          <h5 class="mb-0">PERFIL</h5>
        </div>
        <form method="POST" action="{{ url_for('actualizacion_datos') }}">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" name="nombre" class="form-control" value="{{ usuario.Nombre }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Apellido</label>
              <input type="text" name="apellido" class="form-control" value="{{ usuario.Apellido or '' }}" />
            </div>
            <div class="col-md-12">
              <label class="form-label">Email</label>
              <input type="email" name="correo" class="form-control" value="{{ usuario.Correo }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">G√©nero</label>
              <input type="text" name="genero" class="form-control" value="{{ usuario.Genero or '' }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Tel√©fono</label>
              <input type="tel" name="telefono" class="form-control" value="{{ usuario.Telefono or '' }}" />
            </div>
            <div class="col-12 text-end">
              <button type="submit" class="btn btn-green mt-3">Guardar cambios</button>
            </div>
          </div>
        </form>
      </div>

      <!-- Secci√≥n Direcciones -->
      <div id="seccion-direcciones" class="card shadow-sm p-4" style="display:none;">
        <div class="profile-header mb-4">
          <h5 class="mb-0">DIRECCIONES</h5>
          <button type="button" class="btn btn-green btn-sm" data-bs-toggle="modal" data-bs-target="#modalDireccion">
            <i class="bi bi-plus-lg me-1"></i>A√±adir direcci√≥n
          </button>
        </div>
        <div class="list-group">
          {% for dir in direcciones %}
          <div class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
            <div>
              <div><strong>Direcci√≥n:</strong> {{ dir.Direccion }}</div>
              <div><strong>Ciudad:</strong> {{ dir.Ciudad }}</div>
              <div><strong>Departamento:</strong> {{ dir.Departamento }}</div>
              <div><strong>Pa√≠s:</strong> {{ dir.Pais }}</div>
            </div>
            <form action="{{ url_for('borrar_direccion', id_direccion=dir.ID_Direccion) }}" method="POST">
              <button type="submit" class="btn btn-link text-danger d-flex align-items-center gap-1 p-0">
                <i class="bi bi-trash fs-5"></i> Borrar
              </button>
            </form>
          </div>
          {% else %}
          <p class="text-muted">No tienes direcciones registradas.</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal A√±adir Direcci√≥n -->
<div class="modal fade" id="modalDireccion" tabindex="-1" aria-labelledby="modalDireccionLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content p-4 rounded-4">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold" id="modalDireccionLabel">A√ëADIR DIRECCI√ìN</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
       
        <form method="POST" action="{{ url_for('agregar_direccion') }}">
          <div class="mb-3">
            <label for="pais" class="form-label">Pa√≠s</label>
            <select name="pais" id="pais" class="form-select rounded-pill">
              <option selected>Colombia</option>
            </select>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="departamento" class="form-label">Departamento</label>
              <select name="departamento" id="departamento" class="form-select rounded-pill">
          <option selected>Bogot√°, D.C.</option>
        </select>

            </div>
            <div class="col-md-6">
              <label for="municipio" class="form-label">Municipio</label>
              <select name="municipio" id="municipio" class="form-select rounded-pill">
              <option selected>Bogot√°, D.C.</option>
            </select>

            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="direccion" class="form-label">Direcci√≥n</label>
              <input type="text" name="direccion" id="direccion" class="form-control rounded-pill" placeholder="Direcci√≥n" required />
            </div>
            <div class="col-md-6">
              <label for="infoAdicional" class="form-label">Informaci√≥n adicional</label>
              <input type="text" name="infoAdicional" id="infoAdicional" class="form-control rounded-pill" placeholder="Apto. 201, torre 5" />
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="barrio" class="form-label">Barrio</label>
              <input type="text" name="barrio" id="barrio" class="form-control rounded-pill" placeholder="Barrio" />
            </div>
            <div class="col-md-6">
              <label for="destinatario" class="form-label">Destinatario</label>
              <input type="text" name="destinatario" id="destinatario" class="form-control rounded-pill" placeholder="Qui√©n recibe" />
            </div>
          </div>

          <div class="text-end mt-4">
            <button type="submit" class="btn btn-green px-4 py-2 rounded-pill">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Modal de confirmaci√≥n -->
<div class="modal fade" id="modalGuardado" tabindex="-1" aria-labelledby="modalGuardadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4 rounded-4 text-center">
      <h5 class="modal-title mb-3 text-success fw-bold" id="modalGuardadoLabel">
        ‚úÖ Direcci√≥n guardada
      </h5>
      <p>Tu nueva direcci√≥n ha sido registrada correctamente.</p>
      <div class="d-flex justify-content-center gap-3 mt-3">
        <button type="button" class="btn btn-outline-secondary px-4 rounded-pill" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-success px-4 rounded-pill" onclick="verDirecciones()">Ver direcciones</button>
      </div>
    </div>
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const menuPerfil = document.getElementById('menu-perfil');
  const menuDirecciones = document.getElementById('menu-direcciones');
  const seccionPerfil = document.getElementById('seccion-perfil');
  const seccionDirecciones = document.getElementById('seccion-direcciones');

  function activarMenu(seccion) {
    if (seccion === 'perfil') {
      seccionPerfil.style.display = 'block';
      seccionDirecciones.style.display = 'none';
      menuPerfil.classList.add('active');
      menuDirecciones.classList.remove('active');
    } else {
      seccionPerfil.style.display = 'none';
      seccionDirecciones.style.display = 'block';
      menuPerfil.classList.remove('active');
      menuDirecciones.classList.add('active');
    }
  }

  // Eventos de los botones de men√∫
  menuPerfil.addEventListener('click', e => {
    e.preventDefault();
    activarMenu('perfil');
  });

  menuDirecciones.addEventListener('click', e => {
    e.preventDefault();
    activarMenu('direcciones');
  });

  // ‚úÖ Verifica si se acaba de guardar una direcci√≥n
  const params = new URLSearchParams(window.location.search);
  if (params.get("direccion_guardada") === "1") {
    const modal = new bootstrap.Modal(document.getElementById('modalGuardado'));
    modal.show();
    activarMenu('direcciones'); // Activa la pesta√±a de direcciones
  }
});

// Funci√≥n para el bot√≥n "Ver direcciones" del modal
function verDirecciones() {
  document.getElementById("menu-direcciones").click();
  const modal = bootstrap.Modal.getInstance(document.getElementById('modalGuardado'));
  modal.hide();
}
</script>

</body>
</html>
